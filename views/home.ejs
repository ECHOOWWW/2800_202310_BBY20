<%- include("templates/header") %>
<%- include("templates/navbar_top") %>
<link rel="stylesheet" href="/css/authentication.css">
<link rel="stylesheet" href="/css/home.css">

</head>
<body>
  <div class="greeting"><h2>Hello, <%= name %>ðŸŒž</h2></div>
  <div class="goals">
    <h2>My Goals ðŸŽ¯</h2> 
    <div class="rings">
      <div class="percent1">
          <svg>
            <circle cx="35" cy="35" r="35"></circle>
            <circle cx="35" cy="35" r="35"></circle>
          </svg>
          <div class="number">
            <h2>75<span>%</span></h2>
            <br>
            Calories
            <%=current_calorie%>/<%=calorie_goal%>
          </div>
    </div>
      <div class="percent2">
          <svg>
            <circle cx="35" cy="35" r="35"></circle>
            <circle cx="35" cy="35" r="35"></circle>
          </svg>
          <div class="number">
            <h2>33<span>%</span></h2>
            <br>
            Carbs
            <%=current_carbs%>/<%=carbs_goal%>
          </div>
      </div>
        <div class="percent3">
          <svg>
            <circle cx="35" cy="35" r="35"></circle>
            <circle cx="35" cy="35" r="35"></circle>
          </svg>
          <div class="number">
            <h2>33<span>%</span></h2>
            <br>
            Protein
            <%=current_protein%>/<%=protein_goal%>
          </div>
      </div>
        <div class="percent4">
          <svg>
            <circle cx="35" cy="35" r="35"></circle>
            <circle cx="35" cy="35" r="35"></circle>
          </svg>
          <div class="number">
            <h2>33<span>%</span></h2>
            <br>
            Fat <br>
            <%=current_fat%>/<%=fat_goal%>
          </div>
      </div>
    </div>
  </div>
  <% const calorie_progress = Math.round((current_calorie / calorie_goal) * 100); %>
  <% const carbs_progress = Math.round((current_carbs / carbs_goal) * 100); %>
  <% const protein_progress = Math.round((current_protein / protein_goal) * 100); %>
  <% const fat_progress = Math.round((current_fat / fat_goal) * 100); %>    
  <div class="nearby">
    <h2>Nearby</h2>
  </div>

    <!-- <button onclick="window.location.href='/logout'"class="submit-btn">
    Log out
  </button> -->
  <!-- JS Scripts go here -->
  <script>
  // mainly based on ChatGPT's hint and answer
  function updateChart(percent1, percent2, percent3, percent4) {
    const circle1 = document.querySelector(".percent1 circle:nth-of-type(2)");
    const circle2 = document.querySelector(".percent2 circle:nth-of-type(2)");
    const circle3 = document.querySelector(".percent3 circle:nth-of-type(2)");
    const circle4 = document.querySelector(".percent4 circle:nth-of-type(2)");
    const number1 = document.querySelector(".percent1 h2");
    const number2 = document.querySelector(".percent2 h2");
    const number3 = document.querySelector(".percent3 h2");
    const number4 = document.querySelector(".percent4 h2");

    const radius = circle1.r.baseVal.value;
    const circumference = 2 * Math.PI * radius;
    let offset1, offset2, offset3, offset4;

    // Check if the percentage is greater than 100
    if (percent1 > 100) {
      offset1 = 0; // Display the whole ring
    } else {
      offset1 = circumference - (percent1 / 100) * circumference;
    }

    if (percent2 > 100) {
      offset2 = 0; // Display the whole ring
    } else {
      offset2 = circumference - (percent2 / 100) * circumference;
    }

    if (percent3 > 100) {
      offset3 = 0; // Display the whole ring
    } else {
      offset3 = circumference - (percent3 / 100) * circumference;
    }

    if (percent4 > 100) {
      offset4 = 0; // Display the whole ring
    } else {
      offset4 = circumference - (percent4 / 100) * circumference;
    }

    circle1.style.strokeDasharray = `${circumference} ${circumference}`;
    circle1.style.strokeDashoffset = offset1;
    circle2.style.strokeDasharray = `${circumference} ${circumference}`;
    circle2.style.strokeDashoffset = offset2;
    circle3.style.strokeDasharray = `${circumference} ${circumference}`;
    circle3.style.strokeDashoffset = offset3;
    circle4.style.strokeDasharray = `${circumference} ${circumference}`;
    circle4.style.strokeDashoffset = offset4;
    number1.textContent = `${percent1}%`;
    number2.textContent = `${percent2}%`;
    number3.textContent = `${percent3}%`;
    number4.textContent = `${percent4}%`;
  }
  updateChart("<%=calorie_progress%>", "<%=carbs_progress%>", "<%=protein_progress%>", "<%=fat_progress%>")
  </script>
<%- include("templates/navbar_bottom") %>
<%- include("templates/footer") %>