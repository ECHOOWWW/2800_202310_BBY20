<%- include("templates/header") %> 
<%- include("templates/navbar_top") %>

<link rel="stylesheet" href="/css/menu.css">

</head>

<body>
<header>
  <h1><%= restaurant.name %></h1>
</header>

<main>
  <% menu.forEach(function(item) { %>
  <div class="card">
    <img src="<%= restaurant.image %>" alt="<%= restaurant.name %>" />
    <div class="item-details">
      <h2><%= item.item %></h2>
      <p>
        <small><strong>Calories:</strong> <%= item.calories %>Cals</small>
      </p>
      <p>
        <small><strong>Protein:</strong> <%= item.protein %>g</small>
      </p>
      <p>
        <small><strong>Fat:</strong> <%= item.total_fat %>g</small>
      </p>
    </div>
    <button class="add-btn" onclick="addToCart(<%= JSON.stringify(item) %>)">Add</button>
  </div>
  <% }); %>
</main>

<div id="tray-preview" style="display:none">
  <button id="close-btn" onclick="closeTrayPreview()">x</button>
  <h2>Total Nutrition Values of My Tray</h2>
  <p id="total-calories"></p>
  <p id="total-carbs"></p>
  <p id="total-protein"></p>
  <p id="total-fat"></p>

  <div id="detailed-info" style="display:none">
    <p id="total-fibre"></p>
    <p id="total-sugar"></p>
    <p id="total-vita-a"></p>
    <p id="total-vita-c"></p>
    <p id="total-calcium"></p>
    <p id="total-sodium"></p>
    <p id="total-cholesterol"></p>
  </div>
  
  <button id="more-btn" onclick="showMore()">More</button>
</div>

<div class="placeholder"></div>

<script>
function closeTrayPreview() {
  const trayPreview = document.getElementById('tray-preview');
  trayPreview.style.display = 'none';
}

let totalCalories = 0;
let totalCarbs = 0;
let totalProtein = 0;
let totalFat = 0;
let totalFibre = 0;
let totalSugar = 0;
let totalVitaA = 0;
let totalVitaC = 0;
let totalCalcium = 0;
let totalSodium = 0;
let totalCholesterol = 0;

function addToCart(item) {
  totalCalories += item.calories;
  totalCarbs += item.total_carb;
  totalProtein += item.protein;
  totalFat += item.total_fat;
  totalFibre += item.fibre;
  totalSugar += item.sugar;
  totalVitaA += item.vit_a;
  totalVitaC += item.vit_c;
  totalCalcium += item.calcium;
  totalSodium += item.sodium;
  totalCholesterol += item.cholesterol;
  
  document.getElementById('total-calories').textContent = `Total Calories: ${totalCalories}Cals`;
  document.getElementById('total-carbs').textContent = `Total Carbs: ${totalCarbs}g`;
  document.getElementById('total-protein').textContent = `Total Protein: ${totalProtein}g`;
  document.getElementById('total-fat').textContent = `Total Fat: ${totalFat}g`;

  const trayPreview = document.getElementById('tray-preview');
  if (trayPreview.style.display === 'none') {
    trayPreview.style.display = 'block';
  }
}

let isMoreClicked = false;

function showMore() {
  const detailedInfo = document.getElementById('detailed-info');
  if (isMoreClicked) {
    detailedInfo.style.display = 'none';
    document.getElementById('more-btn').textContent = 'More';
    isMoreClicked = false;
  } else {
    detailedInfo.style.display = 'block';
    document.getElementById('more-btn').textContent = 'Less';
    isMoreClicked = true;

    document.getElementById('total-fibre').textContent = `Total Fibre: ${totalFibre}g`;
    document.getElementById('total-sugar').textContent = `Total Sugar: ${totalSugar}g`;
    document.getElementById('total-vita-a').textContent = `Total Vitamin A: ${totalVitaA}%`;
    document.getElementById('total-vita-c').textContent = `Total Vitamin C: ${totalVitaC}%`;
    document.getElementById('total-calcium').textContent = `Total Calcium: ${totalCalcium}%`;
    document.getElementById('total-sodium').textContent = `Total Sodium: ${totalSodium}mg`;
    document.getElementById('total-cholesterol').textContent = `Total Cholesterol: ${totalCholesterol}mg`;
  }
}

</script>

<%- include('templates/navbar_bottom') %> 
<%- include("templates/footer") %>
