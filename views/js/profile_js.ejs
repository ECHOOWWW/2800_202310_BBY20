<script>
  // Get references to various elements in the DOM
  const activity_select = document.getElementById("activity");
  const goal_select = document.getElementById("goal");
  const sex_select = document.querySelectorAll(".sex");
  const form = document.getElementById("profile-form");
  const editButton = document.getElementById("edit-button");
  const saveButton = document.getElementById("save-button");
  const back = document.getElementById("backbutton");

  // Set initial display styles for buttons
  editButton.style.display = "block";
  saveButton.style.display = "none";
  back.style.display = "block";

  // Set the selected option in the goal select based on a value from the server
  for (var i = 0; i < goal_select.options.length; i++) {
    var option = goal_select.options[i];
    if ("<%=goal %>" === option.value) {
      option.selected = true;
    }
  }

  // Set the selected option in the activity select based on a value from the server
  for (var j = 0; j < activity_select.options.length; j++) {
    var option = activity_select.options[j];
    if ("<%=activity %>" === option.value) {
      option.selected = true;
    }
  }

  console.log(sex_select);
  // Set the checked state of the sex select based on a value from the server
  for (var k = 0; k < sex_select.length; k++) {
    var option = sex_select[k];
    if ("<%=sex%>" === option.value) {
      option.checked = true;
    }
  }

  // Event listener for the edit button
  editButton.addEventListener("click", () => {
    form.querySelectorAll("input").forEach((input) => {
      input.disabled = false;
    });
    form.querySelectorAll("select").forEach((input) => {
      input.disabled = false;
    });
    editButton.style.display = "none";
    saveButton.style.display = "block";
  });

  // AJAX part mainly generated by ChatGPT
  // GPT_Prompt_3
  // Send the profile update request using AJAX
  $(document).ready(function () {
    $("#profile-form").submit(function (event) {
      event.preventDefault(); // Prevent the form from submitting normally
      $.ajax({
        url: "/update_profile",
        method: "POST",
        data: $(this).serialize(), // Serialize the form data
        success: function (data) {
          // Show a success message using SweetAlert
          Swal.fire({
            title: "Success",
            text: "Profile updated",
            icon: "success",
            confirmButtonText: "OK",
          }).then(function () {
            // Redirect to the profile page after clicking "OK"
            window.location.href = "/profile";
          });
        },
      });
    });
  });

  // Function to confirm logout using SweetAlert
  function confirmLogout() {
    Swal.fire({
      title: "Are you sure you want to logout?",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Yes, logout!",
      cancelButtonText: "No, cancel",
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = "/logout"; // Redirect to the logout page if confirmed
      }
    });
  }
</script>
